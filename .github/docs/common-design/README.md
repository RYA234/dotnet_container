# 共通設計書

## 概要

システム全体で共通で使用する設計・規約を定義します。
すべての機能はこの共通設計に従って実装します。

---

## ドキュメント一覧

### Phase 1: 最優先（実装済み）

| ドキュメント | 概要 | ステータス |
|------------|------|----------|
| [アーキテクチャ設計](architecture.md) | システム構成図、デプロイ構成、レイヤー構成 | ✅ |
| [クラス図](class-diagram.md) | システム全体のクラス構成、主要インターフェース | ✅ |
| [シーケンス図](sequence-diagram.md) | 典型的な処理フロー、エラーフロー | ✅ |

### Phase 2: 次に実装（実装済み）

| ドキュメント | 概要 | 単体テスト仕様書 | ステータス |
|------------|------|----------------|----------|
| [エラーハンドリング](error-handling.md) | 例外処理方針、リトライ、Circuit Breaker | [テスト仕様書](error-handling-test.md) | ✅ |
| [セキュリティ](security.md) | 認証・認可、SQLインジェクション対策、秘密情報管理 | [テスト仕様書](security-test.md) | ✅ |
| [ログ設計](logging.md) | ログレベル、構造化ログ、マスキング | [テスト仕様書](logging-test.md) | ✅ |
| [DB接続管理](database-connection.md) | 接続文字列、トランザクション、RDBMS切り替え | - | ✅ |

### Phase 3: 将来実装

| ドキュメント | 概要 | ステータス |
|------------|------|----------|
| [設定管理](configuration.md) | appsettings.json、環境変数、検証 | 🚧 |
| [依存性注入](dependency-injection.md) | サービスライフタイム、DI登録規則 | 🚧 |
| [パフォーマンス設計](performance.md) | キャッシュ、非同期処理 | 🚧 |
| [監視・メトリクス](monitoring.md) | ヘルスチェック、メトリクス | 🚧 |

---

## 使い方

### 新機能実装時

1. **共通設計を確認**
   - [アーキテクチャ設計](architecture.md) でレイヤー構成を確認
   - [クラス図](class-diagram.md) で命名規則を確認
   - [シーケンス図](sequence-diagram.md) で処理フローを確認
   - [エラーハンドリング](error-handling.md) で例外処理方針を確認
   - [セキュリティ](security.md) でセキュリティ対策を確認
   - [ログ設計](logging.md) でログ出力方針を確認
   - [DB接続管理](database-connection.md) でDB接続・トランザクション管理を確認

2. **機能別設計書を作成**
   - `features/template/` をコピー
   - 共通設計に従って設計書を記載

3. **実装**
   - 共通設計に従ってコーディング

4. **テスト実装**
   - 各設計書の単体テスト仕様書を参照
   - xUnit, FluentAssertions, Moq を使用
   - 目標カバレッジ: 85%以上

---

## テスト仕様書一覧

### Phase 2（実装済み）

| テスト仕様書 | 対象設計書 | 主なテスト対象 |
|------------|----------|--------------|
| [エラーハンドリングテスト](error-handling-test.md) | エラーハンドリング設計 | カスタム例外、Controller エラーハンドリング、リトライ、Circuit Breaker |
| [セキュリティテスト](security-test.md) | セキュリティ設計 | 認証・認可、SQLインジェクション対策、XSS対策、秘密情報管理 |
| [ログテスト](logging-test.md) | ログ設計 | 構造化ログ、パフォーマンス測定ログ、セキュリティログ、マスキング |

---

## 参考

- [機能別設計書](../features/)
- [ADR](../adr/)
- [copilot-instructions.md](../../copilot-instructions.md)
